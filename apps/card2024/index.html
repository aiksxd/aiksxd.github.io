<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="css/card.css">
</head>
<body>
    <div id="loader" class="loader">
        <h1 data-spotlight="Card-2024">Card-2024</h1>
    </div>
    
    <div class="overlay" id="overlay">
        <div class="setting" id="setting">
            <button class="close-btn" onclick="closeSetting()"></button>
            <div class="panels-container">
                
            <div class="panel">
                <h2 class="panel-title">
                    <i class="fas fa-tag"></i>
                    <span class="lan">Custome</span>
                </h2>
                <div class="range-container">
                    <div class="player-avatar" id="myAvatar">H</div><input type="file" name="avatar" id="uploadAvatar" onchange="uploadAvatar()" style="display: none;">
                    <input type="text" id="myName" onchange="update_MyName(this.value)" class="input-field" placeholder="Enter your name..." style="width: 70%;">
                </div><br>

                <h2 class="panel-title">
                    <i class="fas fa-door-open"></i>
                    <span class="lan">Join Room</span>
                </h2>
                
                <div class="form-group">
                    <label for="roomId" class="lan">Room ID</label>
                    <input type="text" id="roomId" class="input-field" placeholder="Enter the room ID..." autocomplete="off">
                </div>
                
                <button id="joinRoom" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i>
                    <span class="lan">Join Game</span>
                </button>
                
                <div class="online-rooms">
                    <div class="rooms-header">
                        <div class="rooms-title lan">Online Rooms</div>
                        <button class="refresh-btn" id="refreshRooms">
                            <i class="fas fa-sync-alt"></i> <span class="lan">Refresh</span>
                        </button>
                    </div>
                    
                    <div class="room-list" id="roomList">
                        
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="create-room-section" id="createRoomSection">
                    <h2 class="panel-title">
                        <i class="fas fa-plus-circle"></i>
                        <span class="lan">Create Room</span>
                    </h2>
                    
                    <div class="form-group">
                        <div class="range-container">
                            <span class="lan">Card Number Range: [0 -</span>
                            <input type="number" id="cardRange" class="input-field" value="10" min="3" max="18" style="width: 80px;" onchange="update_Card_Range(this.value)">
                            <span>]</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="lan">Game Mode:</label>
                        <div class="mode-selector">
                            <div class="mode-option" data-mode="asymmetric">
                                <div class="mode-icon">
                                    <i class="fas fa-balance-scale-right"></i>
                                </div>
                                <div class="mode-title lan">Asymmetry</div>
                                <div class="mode-desc lan">Asymmetric Deck</div>
                            </div>
                            <div class="mode-option" data-mode="symmetric">
                                <div class="mode-icon">
                                    <i class="fas fa-equals"></i>
                                </div>
                                <div class="mode-title lan">Symmetry</div>
                                <div class="mode-desc lan">Same Deck</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-display">
                        <div class="info-item">
                            <span class="info-label lan">Room Status:</span>
                            <span class="info-value lan">Waiting to create<span class="status-indicator"></span></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Players:</span>
                            <span class="info-value">0/2</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Game Mode:</span>
                            <span class="info-value" id="gameModeDisplay">Not selected</span>
                        </div>
                    </div>
                    
                    <button id="createRoom" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i>
                        <span class="lan">Create Room</span>
                    </button>
                </div>
                
                <div class="room-info-section" id="roomInfoSection">
                    <h2 class="panel-title">
                        <i class="fas fa-users"></i>
                        <span class="lan">Room Info</span>
                    </h2>
                    
                    <div class="info-display">
                        <div class="info-item" id="copyURL">
                            <span class="info-label lan">Room ID:</span>
                            <span class="info-value" id="currentRoomId"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Room Status:</span>
                            <span class="info-value" id="roomStatus">Waiting <span class="status-indicator waiting"></span></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Card Number Range:</span>
                            <span class="info-value" id="numberRange">0 - 9</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Players:</span>
                            <span class="info-value" id="players">1/2</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label lan">Game Mode:</span>
                            <span class="info-value" id="roomModeDisplay">Asymmetric</span>
                        </div>
                    </div>
                    
                    <div class="player-list">
                        <div class="player-item">
                            <div class="player-avatar">?</div>
                            <div class="player-name">?</div>
                            <div class="player-ready">?</div>
                        </div>
                    </div>
                    
                    <div class="ready-container" id="readyContainer">
                        <label class="ready-label">
                            <input type="checkbox" id="ready" class="ready-checkbox">
                            <div class="ready-visual">
                                <svg viewBox="0 0 80 80">
                                    <circle r="35" cx="40" cy="40"/>
                                    <path class="readyTick" d="m18 33 19 18 38-33"/>
                                </svg>
                            </div>
                            <span>Ready Status <span class="status-indicator"></span></span>
                        </label>
                    </div>
                    
                    <button id="leaveRoom" class="btn btn-danger btn-block">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="lan">Exit Room</span>
                    </button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <button class="gear-btn" onclick="openSetting()">
        <svg class="gear" fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1">
            <path d="M19.9,12.66a1,1,0,0,1,0-1.32L21.18,9.9a1,1,0,0,0,.12-1.17l-2-3.46a1,1,0,0,0-1.07-.48l-1.88.38a1,1,0,0,1-1.15-.66l-.61-1.83A1,1,0,0,0,13.64,2h-4a1,1,0,0,0-1,.68L8.08,4.51a1,1,0,0,1-1.15.66L5,4.79A1,1,0,0,0,4,5.27L2,8.73A1,1,0,0,0,2.1,9.9l1.27,1.44a1,1,0,0,1,0,1.32L2.1,14.1A1,1,0,0,0,2,15.27l2,3.46a1,1,0,0,0,1.07.48l1.88-.38a1,1,0,0,1,1.15.66l.61,1.83a1,1,0,0,0,1,.68h4a1,1,0,0,0,.95-.68l.61-1.83a1,1,0,0,1,1.15-.66l1.88.38a1,1,0,0,0,1.07-.48l2-3.46a1,1,0,0,0-.12-1.17ZM18.41,14l.8.9-1.28,2.22-1.18-.24a3,3,0,0,0-3.45,2L12.92,20H10.36L10,18.86a3,3,0,0,0-3.45-2l-1.18.24L4.07,14.89l.8-.9a3,3,0,0,0,0-4l-.8-.9L5.35,6.89l1.18.24a3,3,0,0,0,3.45-2L10.36,4h2.56l.38,1.14a3,3,0,0,0,3.45,2l1.18-.24,1.28,2.22-.8.9A3,3,0,0,0,18.41,14ZM11.64,8a4,4,0,1,0,4,4A4,4,0,0,0,11.64,8Zm0,6a2,2,0,1,1,2-2A2,2,0,0,1,11.64,14Z"/>
        </svg>
    </button>

    <div class="container">
        <div class="card" data-index="0" style="--i:-4;">-4</div>
        <div class="card" data-index="1" style="--i:-3;">-3</div>
        <div class="card" data-index="2" style="--i:-2;">-2</div>
        <div class="card" data-index="3" style="--i:-1;">-1</div>
        <div class="card" data-index="4" style="--i:0;">0</div>
        <div class="card" data-index="5" style="--i:1;">1</div>
        <div class="card" data-index="6" style="--i:2;">2</div>
        <div class="card" data-index="7" style="--i:3;">3</div>
        <div class="card" data-index="8" style="--i:4;">4</div>
    </div>
    <div class="oppositeContainer">
        <div class="card" data-index="0" style="--i:-4;">-4</div>
        <div class="card" data-index="1" style="--i:-3;">-3</div>
        <div class="card" data-index="2" style="--i:-2;">-2</div>
        <div class="card" data-index="3" style="--i:-1;">-1</div>
        <div class="card" data-index="4" style="--i:0;">0</div>
        <div class="card" data-index="5" style="--i:1;">1</div>
        <div class="card" data-index="6" style="--i:2;">2</div>
        <div class="card" data-index="7" style="--i:3;">3</div>
        <div class="card" data-index="8" style="--i:4;">4</div>
    </div>

    <div id="gameField">
        <div class="field-label">dragging here to play cards</div>
        <section class="opponent-zone"></section>
        <section class="own-zone"></section>
    </div>

    <div class="cardInfo" style="opacity: 0;">
        <p>Card Name: <span class="card-name"></span></p>
        <p>Card Content: <span class="card-value"></span></p>
    </div>

    <div class="gameScore">
        <h2><span class="score">0</span> : <span class="opponent-score">0</span></h2>
    </div>
    <script src="js/language.js"></script>
    <script src="config.js"></script>
    <script src="../../js/api.js"></script>
    <script>
        // init language
        function update_Page_Language(lan) {
            change_Language(lan, 'index');
            translate_Attribute(lan, "placeholder", 'placeholder-index');
        }
    </script>
    <script src="js/peerjs.min.js"></script>
    <script src="js/card.js"></script>
    <script>
        peer = new Peer({ debug: 2});
        peer.on('open', (id) => {
            myId = id;
            roomInfo.id = myId
            document.getElementById('currentRoomId').textContent = myId;
        });
        
        peer.on('connection', (conn) => {
            connIds.push(conn.peer);
            conns.push(conn);

            conn.on('open', () => {
                console.log('Connection established with:', conn.peer);
            });
            
            // Receive the text: Host <-- Guest
            conn.on('data', (data) => {
                switch (data[0]) {
                    case 'want':
                        if (conns.length < config['max_Players']) {
                            conns[0].send(['entry']);
                        } else {
                            conns[1].send(['crowded']);
                            conns[1].close();
                            conns.splice(1, 1);
                            connIds.splice(1, 1);
                        }
                    break;
                    case 'ready':
                        if (data[1] === true) { // more player todo
                            roomInfo.players[1].status = 'ready';
                        } else {
                            roomInfo.players[1].status = 'not-ready';
                        }
                        updateRoomInfo(roomInfo);
                        
                        if (roomInfo.players.length >= config['min_Players']) {
                            let judgement = true;
                            roomInfo.players.forEach(player => {
                                if (player.status === 'ready') {
                                } else { judgement = false}
                            });
                            if (judgement) {
                                roomInfo.status = 'playing';
                                updateRoomInfo(roomInfo);
                                setTimeout(() => {
                                    let turn = Math.random();
                                    conns[0].send(['start', Math.round(1-turn)]);
                                    init_Game(roomInfo, Math.round(turn));
                                }, 2000);
                            }
                        }
                    break;
                    case 'info':
                        roomInfo.players[roomInfo.players.length] = { avatar: data[1], name: data[2], status: 'not-ready' };
                        conns[0].send(['joined']);
                        updateRoomInfo(roomInfo);
                    break;
                    case 'played':
                        opponent_Played_Card_Date_Index = data[1];
                        let tempCard = unkonwn_Card.cloneNode(true);
                        tempCard.id = "tempCard";
                        document.getElementsByClassName('opponent-zone')[0].append(tempCard);
                        if (played_Card_Date_Index) {
                            updateGameResult(deck[played_Card_Date_Index], opponentDeck[opponent_Played_Card_Date_Index]);
                        }
                        adjust_Card_Style(opponentDeck.length, oppositeContainer);
                    break;
                    break;
                    default:
                        console.log("unknown data: " + data);
                }
            });

            conn.on('close', () => {
                if (!conns[0].open) {
                    if (config['app_Mode']) {
                        pop_Msg(res_Strings['card'][18][config.language]);
                    } else {
                        alert(res_Strings['card'][18][config.language]);
                    }
                }
            });
        });

        function tryToConnect(object, id) {
            switch (object) {
                case 'parent':
                    if (parent_Node) {
                        parent_Node.close();
                        // [ mark of sorting, myId, number of who be effected, if keep parent_Node firmly here ]
                        // liveSend([3, peer.id, 0, false]);     // remind child node change parent_NodeNode
                    }
                    parent_Node = peer.connect(id);

                    parent_Node.on('open', () => {
                        parent_Node.send(['want', peer.id]);
                    });
            
                    parent_Node.on('data', (data) => {
                        switch (data[0]) {
                            case 'entry':
                                conns[0] = false;   // prevent other connecting player & affecting judgement
                                parent_Node.send(['info', myAvatar, myName]);
                            break;
                            case 'joined':
                                // style test
                                if (config['app_Mode']) {
                                    pop_Msg('Connect successfully');
                                }

                                joinRoomBtn.innerHTML = '<i class="fas fa-check"></i> '+ res_Strings['card'][12][config.language];
                                joinRoomBtn.style.background = 'linear-gradient(135deg, #00c853, #1b5e20)';
                                document.getElementById('createRoomSection').classList.add('hide');
                                document.getElementById('roomInfoSection').classList.add('show');
                                document.getElementById('readyContainer').classList.add('show');
                            break;
                            case 'update':
                                roomInfo = data[1];
                                updateRoomInfo(data[1]);
                            break;
                            case 'crowded':
                                if (config['app_Mode']) {
                                    pop_Msg(res_Strings['card'][11][config.language]);
                                } else {
                                    alert(res_Strings['card'][11][config.language]);
                                }
                                joinRoomBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> '+ res_Strings['card'][11][config.language];
                                joinRoomBtn.style.background = 'linear-gradient(135deg, #ff5252, #b71c1c)';
                                setTimeout(() => {
                                    joinRoomBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> '+ res_Strings['card'][8][config.language];
                                    joinRoomBtn.style.background = 'linear-gradient(135deg, #21cbf3, #1976D2)';
                                }, 3000);
                            break;
                            case 'start':
                                init_Game(roomInfo, data[1]);
                            break;
                            case 'played':
                                opponent_Played_Card_Date_Index = data[1];
                                let tempCard = unkonwn_Card.cloneNode(true);
                                tempCard.id = "tempCard";
                                document.getElementsByClassName('opponent-zone')[0].append(tempCard);
                                if (played_Card_Date_Index) {
                                    updateGameResult(deck[played_Card_Date_Index], opponentDeck[opponent_Played_Card_Date_Index]);
                                }
                                adjust_Card_Style(opponentDeck.length, oppositeContainer);
                            break;
                            default:
                                console.log("unknown data: " + data);
                        }
                    });

                    parent_Node.on('close', () => {
                        if (config['app_Mode']) {
                            pop_Msg(res_Strings['card'][18][config.language]);
                        } else {
                            alert(res_Strings['card'][18][config.language]);
                        }
                        joinRoomBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> '+ res_Strings['card'][8][config.language];
                        joinRoomBtn.style.background = 'linear-gradient(135deg, #21cbf3, #1976D2)';
                        document.getElementById('createRoomSection').classList.remove('hide');
                        document.getElementById('roomInfoSection').classList.remove('show');
                        document.getElementById('readyContainer').classList.remove('show');
                    });

                    parent_Node.on('error', (err) => {
                        console.error('Connection error:', err);
                        joinRoomBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> '+ res_Strings['card'][10][config.language];
                        joinRoomBtn.style.background = 'linear-gradient(135deg, #ff5252, #b71c1c)';
                        setTimeout(() => {
                            joinRoomBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> '+ res_Strings['card'][8][config.language];
                            joinRoomBtn.style.background = 'linear-gradient(135deg, #21cbf3, #1976D2)';
                        }, 3000);
                    });
                    break;
                    break;
            
                default:
                    break;
            }
        }
        const cardRangeInput = document.getElementById('cardRange');
        const rangeValueDisplay = document.querySelector('.range-value');
        const modeOptions = document.querySelectorAll('.mode-option');
        let selectedMode = null;
        
        modeOptions.forEach(option => {
            option.addEventListener('click', function() {
                modeOptions.forEach(opt => opt.classList.remove('selected'));

                this.classList.add('selected');
                selectedMode = this.getAttribute('data-mode');
                const modeDisplay = document.getElementById('gameModeDisplay');
                if (selectedMode === 'asymmetric') {
                    modeDisplay.textContent = res_Strings['card'][1][config.language];
                    roomInfo.mode = 'asymmetric';
                } else {
                    modeDisplay.textContent = res_Strings['card'][2][config.language];
                    roomInfo.mode = 'symmetric';
                }
            });
        });
        
        document.querySelector('.mode-option[data-mode="asymmetric"]').classList.add('selected');
        selectedMode = 'asymmetric';
        document.getElementById('gameModeDisplay').textContent = res_Strings['card'][1][config.language];
        
        // ceate room
        const createRoomBtn = document.getElementById('createRoom');
        createRoomBtn.addEventListener('click', function() {
            if (!selectedMode) {
                alert(res_Strings['card'][3][config.language]);
                return;
            }
            
            // this.innerHTML = '<i class="fas fa-check"></i> Room Created ✓';
            // this.style.background = 'linear-gradient(135deg, #00c853, #1b5e20)';
            // this.classList.remove('pulse');
            
            // update room display
            document.getElementById('roomModeDisplay').textContent = selectedMode === 'asymmetric' ? res_Strings['card'][1][config.language] : res_Strings['card'][2][config.language];
            document.getElementById('numberRange').textContent = '0 - '+cardRangeInput.value;
            // server todo
            // addRoomToList({
            //     id: roomId,
            //     players: 1,
            //     maxPlayers: 4,
            //     range: cardRangeInput.value,
            //     status: 'waiting',
            //     mode: selectedMode
            // });
            roomInfo = {
                id: myId,
                status: 'waiting',
                range: cardRangeInput.value,
                mode: selectedMode,
                players: [
                    { avatar: myAvatar, name: myName, status: "ready" },
                ]
            };
            updateRoomInfo(roomInfo);
            
            document.getElementById('createRoomSection').classList.add('hide');
            document.getElementById('roomInfoSection').classList.add('show');
            document.getElementById('readyContainer').classList.add('show');
            if(document.getElementById('ready').checked == false) {
                document.getElementById('ready').click();
            }
            // updateRoomInfo
        });
        
        // ready change
        const readyCheckbox = document.getElementById('ready');
        readyCheckbox.addEventListener('change', function() {
            const readyLabel = document.querySelector('.ready-label span');
            if(this.checked) {
                if (parent_Node) {
                    parent_Node.send(['ready', true]);  // more player position identify todo
                } else {
                    roomInfo.players[0].status = 'ready';
                    updateRoomInfo(roomInfo);
                    if (roomInfo.players.length >= config['min_Players']) {
                        let judgement = true;
                        roomInfo.players.forEach(player => {
                            if (player.status === 'ready') {
                            } else { judgement = false}
                        });
                        if (judgement) {
                            setTimeout(() => {
                                let turn = Math.random();
                                conns[0].send(['start', Math.round(1-turn)]);
                                init_Game(roomInfo, Math.round(turn));
                            }, 2000);
                        }
                    }
                }
                readyLabel.innerHTML = res_Strings['card'][14][config.language]+' <span class="status-indicator active"></span>';
            } else {
                if (parent_Node) {
                    parent_Node.send(['ready', false]);
                } else {
                    roomInfo.players[0].status = 'not-ready';
                    updateRoomInfo(roomInfo);
                }
                readyLabel.innerHTML = res_Strings['card'][17][config.language]+' <span class="status-indicator"></span>';
            }
        });
        
        // Join room logic
        const joinRoomBtn = document.getElementById('joinRoom');
        joinRoomBtn.addEventListener('click', function() {
            const roomId = document.getElementById('roomId').value;
            if(!roomId) {
                this.innerHTML = '<i class="fas fa-exclamation-circle"></i> '+ res_Strings['card'][9][config.language];
                this.style.background = 'linear-gradient(135deg, #ff5252, #b71c1c)';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-sign-in-alt"></i> '+ res_Strings['card'][8][config.language];
                    this.style.background = 'linear-gradient(135deg, #21cbf3, #1976D2)';
                }, 1500);
                return;
            }
            
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> '+ res_Strings['card'][13][config.language];
            tryToConnect('parent', roomId);
        });
        
        // exit room
        const leaveRoomBtn = document.getElementById('leaveRoom');
        leaveRoomBtn.addEventListener('click', function() {
            conns = [];
            connIds = [];
            parent_Node = null;
            if(document.getElementById('ready').checked == true) {
                document.getElementById('ready').click();
            }
            document.getElementById('createRoomSection').classList.remove('hide');
            document.getElementById('roomInfoSection').classList.remove('show');
            document.getElementById('readyContainer').classList.remove('show');
            joinRoomBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ' + res_Strings['card'][8][config.language];
            joinRoomBtn.style.background = 'linear-gradient(135deg, #21cbf3, #1976D2)';
            // document.getElementById('roomId').value = '';
        });
        
        // 更新房间信息
        function updateRoomInfo(roomInfo) {
            // example:
            // roomInfo = {
            //     id: roomId,
            //     status: 'waiting',
            //     range: 6,
            //     mode: 'asymmetric', // 默认模式
            //     players: [
            //         { name: "玩家Alpha", status: "ready" },
            //         { name: "空位", status: "empty" }
            //     ]
            // };
            
            // // 尝试从房间列表中获取实际模式
            // const room = sampleRooms.find(r => r.id == roomId);
            // if (room) {
            //     roomInfo.mode = room.mode;
            // }
            if (conns[0]) {
                if (conns[0].open) {
                    conns[0].send(['update', roomInfo]);
                }
            }
            switch (roomInfo.status) {
                case 'waiting':
                    document.getElementById('roomStatus').innerHTML = res_Strings['card'][19][config.language]+'<span class="status-indicator waiting"></span>';
                break;
                case 'playing':
                    document.getElementById('roomStatus').innerHTML = res_Strings['card'][20][config.language]+'playing <span class="status-indicator"></span>';
                break;
                default:
                    document.getElementById('roomStatus').innerHTML = 'available <span class="status-indicator active"></span>';
                break;
            }

            // 更新房间信息显示
            document.getElementById('currentRoomId').textContent = `${roomInfo.id}`;
            document.getElementById('roomModeDisplay').textContent = roomInfo.mode === 'asymmetric' ? res_Strings['card'][1][config.language] : res_Strings['card'][2][config.language];
            document.getElementById('numberRange').textContent = '0 - '+ roomInfo.range;
            
            // 更新玩家列表
            const playerList = document.querySelector('.player-list');
            playerList.innerHTML = '';
            document.getElementById('players').textContent = roomInfo.players.length+'/'+config['max_Players'];
            
            roomInfo.players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                let statusHtml;
                if (player.status === 'ready') {
                    statusHtml = '<div class="player-ready">'+res_Strings['card'][14][config.language]+'</div>';
                } else if (player.status === 'not-ready') {
                    statusHtml = '<div class="player-not-ready">'+res_Strings['card'][15][config.language]+'</div>';
                } else {
                    statusHtml = '<div class="player-not-ready">'+res_Strings['card'][16][config.language]+'</div>';
                }
                if (player.avatar) {
                    playerItem.innerHTML = `
                        <div class="player-avatar" style="background-image:url(${player.avatar})"></div>
                        <div class="player-name">${player.name}</div>
                        ${statusHtml}
                    `;
                } else {
                    playerItem.innerHTML = `
                        <div class="player-avatar">${String.fromCharCode(65 + index)}</div>
                        <div class="player-name">${player.name}</div>
                        ${statusHtml}
                    `;
                }
                
                playerList.appendChild(playerItem);
            });
        }
        
        // 在线房间列表功能
        const roomList = document.getElementById('roomList');
        const refreshBtn = document.getElementById('refreshRooms');
        
        // server todo
        const sampleRooms = [
            // { id: 5832, players: 2, maxPlayers: 4, range: 6, status: 'waiting', mode: 'asymmetric' },
            // { id: 9247, players: 4, maxPlayers: 4, range: 8, status: 'playing', mode: 'symmetric' },
            // { id: 1365, players: 1, maxPlayers: 4, range: 5, status: 'waiting', mode: 'asymmetric' },
            // { id: 4781, players: 3, maxPlayers: 4, range: 7, status: 'waiting', mode: 'symmetric' }
        ];
        
        // append room to list
        function addRoomToList(room) {
            const roomItem = document.createElement('div');
            roomItem.className = 'room-item';
            
            const statusClass = room.status === 'waiting' ? 'status-waiting' : 'status-playing';
            const statusText = room.status === 'waiting' ? res_Strings['card'][19][config.language] : res_Strings['card'][20][config.language];
            const modeClass = room.mode === 'asymmetric' ? 'mode-asymmetric' : 'mode-symmetric';
            const modeText = room.mode === 'asymmetric' ? res_Strings['card'][1][config.language] : res_Strings['card'][2][config.language];
            
            roomItem.innerHTML = `
                <div class="room-info">
                    <div class="room-id">${language_Text['index'][2][config.language]} ${room.id}</div>
                    <div class="room-details">
                        <div class="room-status">
                            <span class="status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="room-players">
                            <i class="fas fa-users"></i>
                            <span>${room.players}/${room.maxPlayers}人</span>
                        </div>
                        <div class="room-range">
                            <i class="fas fa-hashtag"></i>
                            <span>${language_Text['index'][7][config.language]} ${room.range}</span>
                        </div>
                        <div class="room-mode">
                            <i class="fas fa-chess"></i>
                            <span class="status ${modeClass}">${modeText}</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary btn-sm join-room-btn" data-room="${room.id}">
                    <i class="fas fa-sign-in-alt"></i> ${language_Text['index'][3][config.language]}
                </button>
            `;
            
            roomList.prepend(roomItem);
            
            // Join room btn
            roomItem.querySelector('.join-room-btn').addEventListener('click', function() {
                const roomId = this.getAttribute('data-room');
                document.getElementById('roomId').value = roomId;
                
                const input = document.getElementById('roomId');
                input.focus();
                input.style.borderColor = '#68E534';
                input.style.boxShadow = '0 0 0 3px rgba(104, 229, 52, 0.3)';
                
                setTimeout(() => {
                    input.style.borderColor = '';
                    input.style.boxShadow = '';
                }, 2000);
            });
        }
        
        // init room list
        function initRoomList() {
            roomList.innerHTML = '';
            
            // server todo
            if (sampleRooms.length === 0) {
                roomList.innerHTML = '<div class="no-rooms">'+res_Strings['card'][0][config.language];+'</div>';
                return;
            }
            sampleRooms.forEach(room => {
                addRoomToList(room);
            });
        }
        
        // server todo
        // refreshBtn.addEventListener('click', function() {
        //     this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing';
        //     // todo
        //     setTimeout(() => {
        //         this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh list';
        //         initRoomList();
        //     }, 800);
        // });
        document.getElementById("myAvatar").addEventListener("click", function (){
            document.getElementById("uploadAvatar").click();
        });
        function update_MyName(name) {
            myName = document.getElementById("myName").value;
            if (config['use_Local_Storage'] && localStorage) {
                localStorage.myName = myName;
            }
        }
        function update_Card_Range(range) {
            if (config['use_Local_Storage'] && localStorage) {
                localStorage.cardRange = range;
            }
        }

        // init cartoon
        window.addEventListener('DOMContentLoaded', () => {
            initRoomList();
            
            document.querySelectorAll('.panel').forEach((panel, index) => {
                panel.style.animation = `fadeInDown 0.5s ease ${index * 0.2}s forwards`;
                panel.style.opacity = 0;
            });
        });
    </script>
</body>
</html>