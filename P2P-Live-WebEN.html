<!DOCTYPE HTML>
<html lang="en" class="navy" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>P2P-Live-Web-EN - AX Blogs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('navy')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">&gt;&gt; P2P-Live-Web(used PeerJS)</li><li class="spacer"></li><li class="chapter-item expanded "><a href="P2P-Live-WebCN.html"><strong aria-hidden="true">1.</strong> P2P简单直播</a></li><li class="chapter-item expanded "><a href="P2P-Live-WebEN.html" class="active"><strong aria-hidden="true">2.</strong> P2P-Live-Web-EN</a></li><li class="chapter-item expanded affix "><li class="part-title">&gt;&gt; PCPE双端开服建站联机教程</li><li class="spacer"></li><li class="chapter-item expanded "><a href="PCPEServerMutliplayGuide.html"><strong aria-hidden="true">3.</strong> 开服联机Mutliplay Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="PCPEMutliplayP1.html"><strong aria-hidden="true">3.1.</strong> 移动端开服Android & IOS</a></li><li class="chapter-item expanded "><a href="PCPEMutliplayP2.html"><strong aria-hidden="true">3.2.</strong> 内网穿透实现</a></li><li class="chapter-item expanded "><a href="PCPEMutliplayP3.html"><strong aria-hidden="true">3.3.</strong> 异地组网实现</a></li><li class="chapter-item expanded "><a href="PCPEMutliplayP4.html"><strong aria-hidden="true">3.4.</strong> 远程协助实现</a></li><li class="chapter-item expanded "><a href="PCPEMutliplayP3.html"><strong aria-hidden="true">3.5.</strong> 链接汇总 & 总结</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">&gt;&gt; 内网穿透实现直播网站</li><li class="spacer"></li><li class="chapter-item expanded "><a href="NatBuildLiveWeb.html"><strong aria-hidden="true">4.</strong> 网穿直播NatLive Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="NatLiveP1.html"><strong aria-hidden="true">4.1.</strong> 准备工作</a></li><li class="chapter-item expanded "><a href="NatLiveP2.html"><strong aria-hidden="true">4.2.</strong> 过程与拓展</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">&gt;&gt; Rust安装bevy于Termux</li><li class="spacer"></li><li class="chapter-item expanded "><a href="RustBevyOnTermux.html"><strong aria-hidden="true">5.</strong> RustBevyOnTermux</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AX Blogs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="p2p-live-web"><a class="header" href="#p2p-live-web">P2P-Live-Web</a></h1>
<p>PS: Due to the lack of attention to the project, all messages will be replied to once every 2 to 3 weeks.</p>
<h2 id="single-room-type-live-streaming"><a class="header" href="#single-room-type-live-streaming"><a href="https://aiksxd.github.io/P2PLiveWeb.html">Single Room Type Live Streaming</a></a></h2>
<h3 id="instructions"><a class="header" href="#instructions">Instructions:</a></h3>
<ol>
<li>Load the file <strong>locally</strong> or <strong>access directly</strong> via the following links, e.g..</li>
<li>The broadcaster clicks the <strong>Start Local Stream</strong> button and shares their ID with the audience.</li>
<li>The audience can connect to any broadcaster's ID, but the connection must remain uninterrupted. If the connection is broken in the middle, a new connection object is required.</li>
</ol>
<h2 id="multi-room-type-url-root"><a class="header" href="#multi-room-type-url-root"><a href="https://aiksxd.github.io/e.g.P2PRootMonitor.html">Multi-Room Type (URL-&gt;ROOT)</a></a></h2>
<p>Version Update Example:</p>
<ul>
<li>e.g.P2PLiveindex.html serves as the website homepage (displaying rooms ready for live streaming and providing entry points)</li>
<li>e.g.P2PRootMonitor.html acts as the website's root node (responsible for monitoring and providing all IDs of live stream initiators to the homepage)</li>
<li>e.g.P2PLiveHost &amp; Guest.html are auxiliary pages placed in the same directory</li>
</ul>
<h3 id="instructions-1"><a class="header" href="#instructions-1">Instructions:</a></h3>
<ol>
<li>Visit the homepage (the root node page contains hyperlinks), enter the <strong>root node's ID</strong>, and click the <strong>Connect</strong> button</li>
<li>The broadcaster clicks <strong>Go To Live</strong> and then <strong>Share Local Stream</strong></li>
<li>After completing step one, audience members can view all active live streaming rooms under the root node (based on the connectivity status of the live streaming pages)</li>
</ol>
<h3 id="extensions"><a class="header" href="#extensions">Extensions:</a></h3>
<ol>
<li>To customize the room list style, modify the parameters in the <code>guest.on('data', (data) =&gt; {</code> section of the live streaming page (e.g.P2PLiveHost). <strong>Note: Do not modify the fifth parameter at index 4!</strong></li>
<li>Optimize the connection method by parsing the <strong>nodesMap array</strong> (containing all node information) yourself (Note: <strong>e.g. version not tested</strong>). The nodesMap of the broadcaster node contains all nested node information, while the <strong>root node nodeMaps</strong> = hostsPeers (excluding sub-child nodes). If you are not satisfied with the current nodesMap array collecting node information, consider <strong>restructuring the recorder() method</strong>. Depending on the broadcaster's device configuration, it is recommended to use a <strong>multi-binary tree-style</strong> connection method.</li>
</ol>
<h2 id="considerations"><a class="header" href="#considerations"><strong>Considerations</strong>:</a></h2>
<ol>
<li>The <strong>root node</strong> has the <strong>highest priority for streaming</strong>, overriding all child nodes and their subsequent children's live streams.</li>
<li><strong>Live media streams are only pushed to child nodes</strong>, unlike the information channel where messages can be received from any node. Therefore, it is advisable for the connected root node to be a live streaming node or monitor (<strong>unidirectional media streaming, bidirectional text messaging</strong>).</li>
<li>If the connection is established before the host starts sharing the media stream, clicking the Connect button again will <strong>refresh the received media stream</strong>.</li>
<li>This file combines <strong>sender and receiver into one</strong>, relying solely on the frontend. This means that everyone's permissions are equal. If deployed in a development or insecure environment, content should be encapsulated and permission levels set.</li>
<li>In the event of the host losing connection, the information from the host's child nodes will not be transmitted to other host's child nodes.</li>
<li>Video quality may initially be blurry when passed from child nodes to sub-child nodes; waiting for synchronization may resolve this (quality synchronization observed after 26 seconds in a test).</li>
</ol>
<p>Note: Desktop stream is obtained by <strong>MediaDevices.getDisplayMedia()</strong> by default, which means <strong>most mobile devices</strong> cannot initiate live streaming and can <strong>only receive media streams and text messages</strong>. It also requires a local development environment or HTTPS to work properly. If needed, you can <strong>modify the getLocalStream() function yourself</strong>.</p>
<h3 id="for-p2p-live-web"><a class="header" href="#for-p2p-live-web">For <strong>P2P-Live-web</strong></a></h3>
<p>it employs a <strong>node-based delivery</strong> that allows data to be passed directly from one node to another, enabling the same text interaction message to be received by anyone connected without relying on a central server, thus significantly reducing network latency.</p>
<p><img src="https://github.com/aiksxd/material/blob/main/img/DeliverGIF.gif" alt="DeliverGIF" /></p>
<h3 id="regarding-exchange"><a class="header" href="#regarding-exchange">Regarding <strong>exchange</strong></a></h3>
<p>it is <strong>only used for bilateral</strong> exchange of media streams rather than transmission. Both the connecting and receiving parties need to submit media streams. If a third party is added, one person's media stream will be <strong>overwritten</strong>.</p>
<ul>
<li><a href="https://aiksxd.github.io/e.g.exchange.html">e.g.Exchange</a></li>
</ul>
<h2 id="issue"><a class="header" href="#issue">Issue:</a></h2>
<h3 id="connect-without-feedbackfailed"><a class="header" href="#connect-without-feedbackfailed">Connect without feedback(failed):</a></h3>
<p>Due to the inherent limitations of P2P,establishing connections between some networks can be challenging, but this can be resolved by bridging networks.</p>
<h3 id="regarding-obtaining-the-connection-status-of-all-nodes"><a class="header" href="#regarding-obtaining-the-connection-status-of-all-nodes">Regarding obtaining the connection status of all nodes:</a></h3>
<p>Although the data transmission between nodes has been completed, due to my limited abilities, the function to parse the array has not been implemented yet.
However, you can still capture the <strong>nodesMap</strong> array in the <strong>built-in console of any node's browser</strong>, which contains all connection IDs and relationships from the root node to child nodes. Its structure is as follows:
<code>[thisID, [childsIDs], null, 1]</code></p>
<ul>
<li><strong>thisID</strong> which first of it is the <strong>root node</strong>.</li>
<li><strong>childsIDs</strong> which first of them are the <strong>child nodes of the root node (if a child node has no children, it is the ID value; if it has children, it is a nested array with the same format)</strong>.</li>
<li>null is used to distinguish the information channel.</li>
<li>1 indicates that the network information originates from the root node (each time a new node joins, it is transmitted along the line to the root node, which then consolidates and distributes it to various nodes; during the consolidation process, this value is 0).</li>
</ul>
<h2 id="about-local-peer-server"><a class="header" href="#about-local-peer-server"><strong>About Local Peer Server</strong>:</a></h2>
<p>(<strong>ignore it if you don't run peerjs server locally</strong>):</p>
<h3 id="peerserver"><a class="header" href="#peerserver">PeerServer</a></h3>
<p>Need to install nodejs at first, and then use its npm to install peer</p>
<pre><code>npm install peer -g
</code></pre>
<p>-g is selective if you only want to use in a folder
local peer server run command(value of path need to be united on web &amp; terminal):</p>
<pre><code> peerjs --port 9000 --key peerjs --path /myapp Started PeerServer on ::, port: 9000, path: /myapp
</code></pre>
<h3 id="modify-js-path"><a class="header" href="#modify-js-path">Modify JS path</a></h3>
<p>Modify path of remote peerjs.min.js to local path of js in headP (example)</p>
<pre><code>&lt;script src=&quot;js/peerjs.min.js&quot;&gt;&lt;/script&gt;

&lt;!--script src=&quot;https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js&quot;&gt;&lt;/script--&gt;
</code></pre>
<h2 id="others"><a class="header" href="#others">Others</a></h2>
<ul>
<li><strong>About P2P</strong>:</li>
</ul>
<blockquote>
<p>P2P is a distributed network architecture where each participant (also known as a node) acts as both a client and a server.
Unlike the traditional client-server model, P2P allows direct communication between nodes without the need for relay through a central server.</p>
</blockquote>
<p><img src="https://github.com/aiksxd/material/blob/main/img/P2PGIF.gif" alt="P2PGIF" /></p>
<ul>
<li><strong>About PeerJS</strong>:</li>
</ul>
<blockquote>
<p>PeerJS: PeerJS is a JavaScript library based on WebRTC for simplifying P2P communication implementation.</p>
<p>Simplified API: PeerJS provides a simple and easy-to-use API that allows developers to quickly establish P2P connections and transfer data.
It abstracts the complex WebRTC details, making the development process more convenient.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="P2P-Live-WebCN.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="PCPEServerMutliplayGuide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="P2P-Live-WebCN.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="PCPEServerMutliplayGuide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
