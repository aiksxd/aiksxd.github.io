<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/appUI.css">
    <link rel="stylesheet" type="text/css" href="css/icon.css">
</head>
<body>
    <div class="feature-group">
        <span class="H-title lan">Apps</span>
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Search for apps or content...">
        </div>
        <div class="filter-options">
            <button id="filter-all" class="green-button filter-btn active lan">All</button>
            <button id="filter-starred" class="green-button filter-btn lan">Starred</button>
        </div>
        
        <div class="app-grid">
            <label data-app-id="PeerLive" data-index="0">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <svg class="app-icon" height="800" width="800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve"><path d="M5 23c-2.2 0-4-1.8-4-4v-8h2v4.5c.6-.3 1.3-.5 2-.5 2.2 0 4 1.8 4 4s-1.8 4-4 4m0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m19 2h-2C22 9.6 14.4 2 5 2V0c10.5 0 19 8.5 19 19m-5 0h-2c0-6.6-5.4-12-12-12V5c7.7 0 14 6.3 14 14m-5 0h-2c0-3.9-3.1-7-7-7v-2c5 0 9 4 9 9"/></svg>
                        <h3 class="app-lan">Blog</h3>
                        <p class="app-description">my blog in here</p>
                    </section>
                    <section class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][4][config['language']])" class="tag green">mdbook</button>
                        </section>
                        <button onclick="launch_Web_App('blog', 'apps/blog/index.html',)" class="green-button">Run</button>
                    </section>
                </div>
            </label>

            <label data-app-id="PeerLive" data-index="1">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <svg class="app-icon" width="150" height="150" viewBox="66 100 55 55"><path d="m87 146 3-16q2-1 2.5 1L90 148q-2 1-2 0Z"/><circle cx="92" cy="125"/><path d="M85 120q9-6 15 2 5 0-1-5-7-6-15.5 1-1 2 1.5 2"/><path d="M80 115q16-11 26 4 2 1 1-3-11-15-29-4 0 3 2 3"/><circle cx="92" cy="125" r="2"/></svg>
                        <h3 class="app-lan">PeerLive</h3>
                        <p class="app-description">easy contact</p>
                    </section>
                    <section class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][0][config['language']])" class="tag purple">SRS</button>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][1][config['language']])" class="tag green">WebRTC</button>
                        </section>
                        <button onclick="launch_Web_App('peerLive', 'apps/PeerLive/index.html',)" class="green-button">Run</button>
                    </section>
                </div>
            </label>

            <label data-app-id="FiveOnline" data-index="2">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <img class="app-icon" src="apps/PeerGame-Tic-Tac-Toe/en/img/move.png" alt="fiveonline"></img>
                        <h3 class="app-lan">FiveOnline</h3>
                        <p class="app-description">online Game</p>
                    </section>
                    <label class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][1][config['language']])" class="tag green">WebRTC</button>
                        </section>
                        <button onclick="launch_Web_App('PeerGame-Tic-Tac-Toe', 'apps/PeerGame-Tic-Tac-Toe/'+ config['language'] +'/P2PLiveIndex.html',)" class="green-button">Run</button>
                    </label>
                </div>
            </label>

            <label data-app-id="doggy" data-index="3">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <img class="app-icon" src="apps/doggy/icon.png" onerror="this.src='apps/doggy/favion.ico'; this.onerror=null" alt="doggy"></img>
                        <h3 class="app-lan">DogHead Generator</h3>
                        <p class="app-description">create your memes</p>
                    </section>
                    <label class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][1][config['language']])" class="tag blue">AI</button>
                        </section>
                        <button onclick="launch_Web_App('doggy', 'apps/doggy/index.html',)" class="green-button">Run</button>
                    </label>
                </div>
            </label>

            <label data-app-id="info" data-index="4">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <svg class="app-icon" width="800" height="800" viewBox="-2 -2 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20C5 20 0 15.523 0 10S5 0 10 0s10 5 10 10-5 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m0-10a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V9a1 1 0 0 1 1-1m0-1a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>
                        <h3 class="app-lan">Info</h3>
                        <p class="app-description">about us</p>
                    </section>
                    <label class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][1][config['language']])" class="tag blue">AI</button>
                        </section>
                        <button onclick="launch_Web_App('info', 'apps/info/index.html',)" class="green-button">Run</button>
                    </label>
                </div>
            </label>

            <label data-app-id="exam" data-index="5">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <svg class="app-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490 490" xml:space="preserve"><path d="M449.25 0H40.85c-11.2 0-20.4 9.2-20.4 20.4v449.2c0 11.2 9.2 20.4 20.4 20.4h408.3c11.2 0 20.4-9.2 20.4-20.4V20.4c.1-11.2-9.1-20.4-20.3-20.4m-20.4 449.2H61.35V40.8h367.5z"/><path d="M130.75 132.7h228.7c11.2 0 19.4-9.2 19.4-20.4s-9.2-20.4-20.4-20.4h-227.7c-11.2 0-20.4 9.2-20.4 20.4s9.1 20.4 20.4 20.4m0 112.3h228.7c11.2 0 19.4-9.2 19.4-20.4s-9.2-20.4-20.4-20.4h-227.7c-11.2 0-20.4 9.2-20.4 20.4s9.1 20.4 20.4 20.4m229.7 61.3-30.1 30.8-30.1-30.8c-7.1-8.2-20.4-8.2-28.6 0-8.2 7.1-8.2 20.4 0 28.6l30.4 31.1-30.4 31.1c-8.2 8.2-8.2 20.4 0 28.6 4.1 4.1 15.3 11.7 28.6 0l30.1-30.8 30.1 30.8c12.4 11.7 24.5 4.1 28.6 0 8.2-7.1 8.2-20.4 0-28.6l-30.5-31.1 30.4-31.1c8.2-8.2 8.2-20.4 0-28.6-8.1-8.2-20.4-8.2-28.5 0"/></svg>
                        <h3 class="app-lan">Exam</h3>
                        <p class="app-description">provide test</p>
                    </section>
                    <label class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][1][config['language']])" class="tag blue">AI</button>
                        </section>
                        <button onclick="launch_Web_App('exam', 'apps/exam/index.html')" class="green-button">Run</button>
                    </label>
                </div>
            </label>

            <label data-app-id="ppt-showcase" data-index="6">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <svg class="app-icon" width="800" height="800" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 6.5V6H2v.5zm4 0V6H6v.5zm7-3h.5v-.207l-.146-.147zm-3-3 .354-.354L10.707 0H10.5zM2.5 7h1V6h-1zm.5 4V8.5H2V11zm0-2.5v-2H2v2zm.5-.5h-1v1h1zm.5-.5a.5.5 0 0 1-.5.5v1A1.5 1.5 0 0 0 5 7.5zM3.5 7a.5.5 0 0 1 .5.5h1A1.5 1.5 0 0 0 3.5 6zm3 0h1V6h-1zm.5 4V8.5H6V11zm0-2.5v-2H6v2zm.5-.5h-1v1h1zm.5-.5a.5.5 0 0 1-.5.5v1A1.5 1.5 0 0 0 9 7.5zM7.5 7a.5.5 0 0 1 .5.5h1A1.5 1.5 0 0 0 7.5 6zM11 6v5h1V6zm-1 1h3V6h-3zM2 5V1.5H1V5zm11-1.5V5h1V3.5zM2.5 1h8V0h-8zm7.646-.146 3 3 .708-.708-3-3zM2 1.5a.5.5 0 0 1 .5-.5V0A1.5 1.5 0 0 0 1 1.5zM1 12v1.5h1V12zm1.5 3h10v-1h-10zM14 13.5V12h-1v1.5zM12.5 15a1.5 1.5 0 0 0 1.5-1.5h-1a.5.5 0 0 1-.5.5zM1 13.5A1.5 1.5 0 0 0 2.5 15v-1a.5.5 0 0 1-.5-.5z"/></svg>
                        <h3 class="app-lan">ppt</h3>
                        <p class="app-description">ppt API showcase</p>
                    </section>
                    <label class="app-more">
                        <section>
                        </section>
                        <button onclick="launch_Web_App('ppt-showcase', 'apps/ppt-showcase/index.html')" class="green-button">Run</button>
                    </label>
                </div>
            </label>

            <label data-app-id="demo" data-index="7">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <div class="app-icon"></div>
                        <h3 class="app-lan">Demo</h3>
                        <p class="app-description">test</p>
                    </section>
                    <label for="" class="app-more">
                        <section>
                            <div class="tag purple">purple</div>
                            <div class="tag green">green</div>
                            <div class="tag orange">orange</div>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][3][config['language']])" class="tag red">online</button>
                            <div class="tag blue">blue</div>
                        </section>
                        <button class="green-button">run</button>
                        <button class="green-button" disabled>disabled</button>
                    </label>
                </div>
            </label>

            <label data-app-id="card2024" data-index="8">
                <input class="toggleApps" type="checkbox" hidden>
                <div class="app-card">
                    <section class="app-overview">
                        <button class="star-button">☆</button>
                        <div class="card2024 app-icon">
                            <div class="card2024 cards-container">
                                <div class="card2024 card blue-card">-1</div>
                                <div class="card2024 card red-card">+1</div>
                            </div>
                            <div class="card2024 app-name">Card-2024</div>
                            
                            <div class="card2024 decoration">
                                <div class="card2024 corner tl"></div>
                                <div class="card2024 corner tr"></div>
                                <div class="card2024 corner bl"></div>
                                <div class="card2024 corner br"></div>
                            </div>
                        </div>
                        <h3 class="app-lan">Card2024</h3>
                        <p class="app-description">card game based on 2024 exam</p>
                    </section>
                    <label for="" class="app-more">
                        <section>
                            <button onclick="pop_Msg(res_Strings['tag-messages'][5][config['language']])" class="tag blue">online PVP</button>
                        </section>
                        <button onclick="launch_Web_App('card2024', 'apps/card2024/index.html')" class="green-button">Run</button>
                    </label>
                </div>
            </label>

        </div>

        <div class="feature-group news-section">
            <span class="H-title lan">News</span>
            <label class="news-item">
                <input class="toggleNews" type="checkbox" hidden>
                <h3 class="news-title lan">New dog meme creater launched</h3>
                <p class="news-summary lan">Click me to learn more...</p>
                <div class="news-detail">
                    <p class="lan">Run in app list and open in sidebar. You can import your own img to create new meme.</p>
                </div>
            </label>
        </div>
    </div>
    
    <button id="create-app-btn" class="green-button lan">Add New App</button>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/language.js"></script>
    <script src="js/theme.js"></script>
    <script>
        function update_Page_Language(lan) {
            change_Language(lan, 'homePage');
            translate_Attribute(lan, "placeholder", 'placeholder-homePage');
            translate_App_List(lan, "all");
        }

        document.getElementById('create-app-btn').addEventListener('click', function() {
            // create new config of app(debug)
            const newAppConfig = {
                appId: 'new-app',
                appName: { en: "New App", zh: "新应用" },
                appDescription: { en: "New application", zh: "新应用程序" },
                appKeywords: ["new", "demo"],
                appIcon: '<svg class="app-icon" width="150" height="150" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#4CAF50"/><path d="M12 8v8M8 12h8" fill="none" stroke="white" stroke-width="2"/></svg>',
                runUrl: 'apps/new-app/index.html',
                tags: [
                    { textKey: 1, class: 'green' },
                    { textKey: 2, class: 'blue' }
                ]
            };
            
            createAppCard(newAppConfig);
        });

        function createAppCard(appConfig) {
            const appGrid = document.querySelector('.app-grid');
            const appCount = appGrid.querySelectorAll('label').length;
            
            const appCardHTML = `
                <label data-app-id="${appConfig.appId}" data-index="${appCount}">
                    <input class="toggleApps" type="checkbox" hidden>
                    <div class="app-card">
                        <section class="app-overview">
                            <button class="star-button">☆</button>
                            ${appConfig.appIcon}
                            <h3 class="app-lan">${appConfig.appName[config['language']]}</h3>
                            <p class="app-description">${appConfig.appDescription[config['language']]}</p>
                        </section>
                        <section class="app-more">
                            <section>
                                ${appConfig.tags.map(tag => 
                                    `<button onclick="pop_Msg(res_Strings['tag-messages'][${tag.textKey}][config['language']])" 
                                        class="tag ${tag.class}">${res_Strings['tags'][tag.textKey]['en']}</button>`
                                ).join('')}
                            </section>
                            <button onclick="launch_Web_App('${appConfig.appId}', '${appConfig.runUrl}')" class="green-button">Run</button>
                        </section>
                    </div>
                </label>
            `;
            
            appGrid.insertAdjacentHTML('beforeend', appCardHTML);
            
            // add resource of language
            addAppLanguageResource(
                appConfig.appName,
                appConfig.appDescription,
                appConfig.appKeywords
            );
            translate_App_List(config['language'], 'new', appCount);
            
            // bind star fn
            const newCard = appGrid.lastElementChild;
            const starButton = newCard.querySelector('.star-button');
            starButton.addEventListener('click', function(e) {
                e.stopPropagation();
                const appId = this.closest('label').dataset.appId;
                const isStarred = this.textContent === '☆';
                
                this.textContent = isStarred ? '★' : '☆';
                const starStorage = JSON.parse(localStorage.getItem('appStars')) || {};
                
                if (isStarred) {
                    this.classList.add('starred');
                    starStorage[appId] = true;
                } else {
                    this.classList.remove('starred');
                    delete starStorage[appId];
                }
                
                localStorage.setItem('appStars', JSON.stringify(starStorage));
                if (document.getElementById('filter-starred').classList.contains('active')) {
                    filterApps();
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // init stars
            const starStorage = JSON.parse(localStorage.getItem('appStars')) || {};
            
            document.querySelectorAll('.star-button').forEach(button => {
                const appId = button.closest('label').dataset.appId;
                if (starStorage[appId]) {
                    button.textContent = '★';
                    button.classList.add('starred');
                }
                
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const appId = this.closest('label').dataset.appId;
                    const isStarred = this.textContent === '☆';
                    
                    this.textContent = isStarred ? '★' : '☆';
                    if (isStarred) {
                        this.classList.add('starred');
                        starStorage[appId] = true;
                    } else {
                        this.classList.remove('starred');
                        delete starStorage[appId];
                    }
                    
                    localStorage.setItem('appStars', JSON.stringify(starStorage));
                    
                    // update filter
                    if (document.getElementById('filter-starred').classList.contains('active')) {
                        filterApps();
                    }
                });
            });
            
            // search button
            const searchInput = document.querySelector('.search-input');
            searchInput.addEventListener('input', filterApps);
            
            // filter button
            document.getElementById('filter-all').addEventListener('click', function() {
                setActiveFilter('all');
                filterApps();
            });
            
            document.getElementById('filter-starred').addEventListener('click', function() {
                setActiveFilter('starred');
                filterApps();
            });
            
            function setActiveFilter(filter) {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`filter-${filter}`).classList.add('active');
            }
            
            function filterApps() {
                const searchTerm = searchInput.value.trim().toLowerCase();
                const isStarredFilter = document.getElementById('filter-starred').classList.contains('active');
                const starStorage = JSON.parse(localStorage.getItem('appStars')) || {};
                
                document.querySelectorAll('.app-grid > label').forEach(app => {
                    const appId = app.dataset.appId;
                    const appIndex = parseInt(app.dataset.index);
                    
                    // get keywords
                    const appNameEn = res_Strings.apps.name[appIndex].en.toLowerCase();
                    const appNameZh = res_Strings.apps.name[appIndex].zh;
                    const appDescEn = res_Strings.apps.description[appIndex].en.toLowerCase();
                    const appDescZh = res_Strings.apps.description[appIndex].zh;
                    const keywords = res_Strings.apps.keywords[appIndex].join(' ').toLowerCase();
                    
                    const searchText = `${appNameEn} ${appNameZh} ${appDescEn} ${appDescZh} ${keywords}`.toLowerCase();
                    
                    // check stars
                    const isStarred = starStorage[appId];
                    
                    let shouldShow = true;
                    let matchScore = 0;
                    
                    if (searchTerm) {
                        const searchTokens = searchTerm.split(/\s+/).filter(t => t);
                        
                        // calc match score
                        searchTokens.forEach(token => {
                            // completed match
                            if (searchText.includes(token)) {
                                matchScore += 3;
                            }
                            // blur match
                            else if (searchText.includes(token.substring(0, Math.max(3, token.length-1)))) {
                                matchScore += 1;
                            }
                            
                            // special（e.g."pl"match"PeerLive"）
                            const regex = new RegExp(token.split('').join('.*?'), 'i');
                            if (regex.test(searchText)) {
                                matchScore += 1;
                            }
                        });
                        
                        // covert others
                        shouldShow = matchScore > 0;
                        app.dataset.matchScore = matchScore;
                    } else {
                        // stars effect without value of search
                        shouldShow = !isStarredFilter || isStarred;
                        app.dataset.matchScore = 0;
                    }
                    
                    // appear & covert
                    if (isStarredFilter && !isStarred) {
                        app.style.display = 'none';
                    } else {
                        app.style.display = shouldShow ? 'block' : 'none';
                    }
                });
                
                // sort with score
                const container = document.querySelector('.app-grid');
                const apps = Array.from(container.querySelectorAll('label[style="display: block;"], label[style="display: block"]'));
                
                apps.sort((a, b) => {
                    const scoreA = parseInt(a.dataset.matchScore || 0);
                    const scoreB = parseInt(b.dataset.matchScore || 0);
                    
                    if (scoreB === scoreA) {
                        return parseInt(a.dataset.index) - parseInt(b.dataset.index);
                    }
                    return scoreB - scoreA;
                });
                
                // reinsert
                apps.forEach(app => container.appendChild(app));
            }
        });
    </script>
</body>
</html>
